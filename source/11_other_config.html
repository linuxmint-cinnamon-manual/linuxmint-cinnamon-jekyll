    <h2 id="toc57"><a id="RefHeading15561713816058"></a><a id="bkmRefHeading15561713816058"></a><a id="toc56"></a><a id="bkmtoc56"></a><a id="RefHeading12581136957987"></a><a id="bkmRefHeading12581136957987"></a><a id="bkmRefHeading12581136957987"></a><a id="bkmbkmRefHeading12581136957987"></a>Прочие настройки</h2>
    <p class="Textbody">В предыдущих очерках говорилось о штатных инструментах для настройки дистрибутива Mint и его среды Cinnamon. Чтобы закончить с этой тему, скажу несколько слов об инструментах конфигурирования не то чтобы нештатных, но непосредственно ни к дистрибутиву, ни к среде не привязанных. И к которым приходится обращаться не так уж часто.</p>
    <h3 id="toc58"><a id="RefHeading15581713816058"></a><a id="bkmRefHeading15581713816058"></a><a id="toc57"></a><a id="bkmtoc57"></a><a id="RefHeading4101136957987"></a><a id="bkmRefHeading4101136957987"></a><a id="bkmRefHeading4101136957987"></a><a id="bkmbkmRefHeading4101136957987"></a>Редактор dconf</h3>
    <p class="Textbody">Редактор dconf появился в GNOME 3 и ныне применяется для низкоуровнего конфигурирования, кроме родительсккой среды, также в Unity, MATE и Cinnamon. Он позволяет напрямую редактировать всю базу конфигурации, как общесистемную, так и штатных пользовательских приложений. И, хотя делает это и не самым простым способом, но даёт доступ к тем настройкам, которые разработчики сред посчитали недостойными внимания конечных пользователей. Или, скорее, решили, что народу они не нужны.</p>
    <p class="Textbody">Правда, в Cinnamon таких замаскированных настроек очень мало. И если в Unity обращаться к Редактору dconf приходится постоянно, а в MATE — периодически, то в нашей среде у меня поводы для запуска этой утилиты возникали буквально считанные разы.</p>
    <p class="Textbody">Запускается эта утилита, кстати, через пункт Редактор dconf в секции Администрирование главного меню, после чего предстаёт в таком виде:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/02/dconf_001.png">
        <img alt="Изображение223" class="frameGraphics" id="223graphic" src="http://alv.me/wp-content/img/im_cin_img/dconf_001-572x369.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:370.83844px" />
      </a>
      <a id="a223graphic"></a>
      <a id="bkm223graphic"></a>
    </p>
    <p class="Textbody">Каждый пункт во фрейме слева разворачивается каскадом вложенных пунктиков и подпунктиков, имя которым далеко превышает легион. И описывать которые я не буду. А дам пару практических рецептов для включения некоторых опций, недоступных через Системные настройки среды Cinnamon.</p>
    <p class="Textbody">Ранее я упоминал, что в текущей версии Cinnamon возможность сохранения сеанса из пункта Автостарт изъята. Но в Редакторе dconf она осталась. И доступ к ней осуществляется по схеме org.cinnamon.SessionManager, где следует включить параметр (в терминологии dconf — ключ) auto-save-session:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/02/dconf_002.png">
        <img alt="Изображение224" class="frameGraphics" id="224graphic" src="http://alv.me/wp-content/img/im_cin_img/dconf_002-572x369.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:370.83844px" />
      </a>
      <a id="a224graphic"></a>
      <a id="bkm224graphic"></a>
    </p>
    <p class="Textbody">Не так давно мы весьма подробно рассмотрели конфигурирование раскладок клавиатуры и их переключателей через соответствующий модуль Системных настроек Cinnamon. И пришли к выводу, что тут можно настроить всё, что только душе угодно. Тогда же было упомянуто, что всё то же самое можно проделать и в Редакторе dconf. Для чего достаточно проследовать по org.gnome.libgnomekbd.keyboard и заполнить желаемым образом поля layouts, model и options:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/02/dconf_003.png">
        <img alt="Изображение225" class="frameGraphics" id="225graphic" src="http://alv.me/wp-content/img/im_cin_img/dconf_003-572x369.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:370.83844px" />
      </a>
      <a id="a225graphic"></a>
      <a id="bkm225graphic"></a>
    </p>
    <p class="Textbody">Как заполнить — описывать не буду, потому что через модуль Клавиатура в Системных настройках это сделать проще. А вот если пройти по схеме org.gnome.libgnomekbd.desktop, то можно включить ключ load-exta-items:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/02/dconf_004.png">
        <img alt="Изображение226" class="frameGraphics" id="226graphic" src="http://alv.me/wp-content/img/im_cin_img/dconf_004-572x369.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:370.83844px" />
      </a>
      <a id="a226graphic"></a>
      <a id="bkm226graphic"></a>
    </p>
    <p class="Textbody">Это обеспечит загрузку редко используемых раскладок клавиатуры. В частности, для русской раскладки окажутся доступными дополнительные варианты — те, что пыведены курсивом:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/02/dconf_005.png">
        <img alt="Изображение227" class="frameGraphics" id="227graphic" src="http://alv.me/wp-content/img/im_cin_img/dconf_005-572x530.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:531.8463px" />
      </a>
      <a id="a227graphic"></a>
      <a id="bkm227graphic"></a>
    </p>
    <p class="Textbody">В русскоязычном окружении этот ключ практического значения не имеет, но для всяких прочих языцей — может пригодиться. Например, для программирования на APL:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/02/dconf_006.png">
        <img alt="Изображение228" class="frameGraphics" id="228graphic" src="http://alv.me/wp-content/img/im_cin_img/dconf_006-572x313.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:314.8258px" />
      </a>
      <a id="a228graphic"></a>
      <a id="bkm228graphic"></a>
    </p>
    <p class="Textbody">Впрочем, более никаких практических задач для решения в Редакторе dconf я не придумал.</p>
    <h3 id="toc59"><a id="RefHeading15601713816058"></a><a id="bkmRefHeading15601713816058"></a><a id="toc58"></a><a id="bkmtoc58"></a><a id="RefHeading4121136957987"></a><a id="bkmRefHeading4121136957987"></a><a id="bkmRefHeading4121136957987"></a><a id="bkmbkmRefHeading4121136957987"></a>Mint и консоль</h3>
    <p class="Textbody">Всё, что было сказано о конфигурировании Mint в предыдущих очерках, относилось к настройкам графических сред, даже конкретно одной представительницы их — Cinnamon. Но ведь в Linux'е есть ещё и «текстовый» режим, то есть консоль. «Текстовый» в кавычках — потому что, конечно, чисто текстовой консоли нынче не найти, наверное, ни в одном дистрибутиве, везде frame buffer — но уж такова традиция.</p>
    <p class="Textbody">Любителей выполнять в «голой» консоли практическую работу нынче не так уж и много. Наверное, поэтому майнтайнеры практически всех дистрибутивов относятся к настройке консольного режима абы как, если не сказать — никак. А уж когда дело доходит до локализованных систем — это вообще туши свет. Редкий дистрибутив может похвастаться тем, что в его голой консоли в ответ на команду</p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">$ date</span> </p>
    <p class="Textbody">выводятся настоящие русские буквы, а не квадратики или кракозябры.</p>
    <p class="Textbody">Повторяю, вряд ли кто будет сочинять в консоли многотомные романы на русском языке — в основном в текстовом режиме приходится загружаться при всякого рода сбоях. Но иногда приходится. Аварийные работы тоже лучше выполнять в комфортной и приятной для глаз обстановке. Да и вообще, как говорил штабс-капитан Мышлаевский, в казарме должен быть порядок, А текстовая консоль большинства современных дистрибутивов от порядка далека.</p>
    <p class="Textbody">К чести Mint надо сказать, что этот дистрибутив принадлежит как раз к тем редким, у которых консоль русифицирована «искаропки». Русские буквы здесь и правильно выводятся, и правильно вводятся. Причём вводятся в том самом варианте русской раскладки клавиатуры, который был задан при инсталляции системы, и переключатель раскладок (по комбинации Alt+Shift) оказывается таким же, как в графическом режиме. В общем, оказывается, что приложить руки к улучшательству есть где. Ибо у применителя всё должно быть прекрасно — в том числе и консоль.</p>
    <p class="Textbody">Особенно раздражает отсутствие поддержки мыши — без неё работа в консоли, даже аварийно-спасательная, становится мучительной. Ибо мышь в консоли — устройство не указательно-позиционирующее, а копировально-вставляющее. Достаточно выделить мышью фрагмент экрана, как он попадает в экранный буфер, откуда может быть вставлен в любое место, в том числе и в другую виртуальную консоль, щелчком средней кнопки мыши. Функция, незаменимая при правке конфигов — а ведь аварийно-спасательные работы обычно к ней и сводятся.</p>
    <p class="Textbody">Поясню (как ни странно, нынче это надо пояснять), что на современных колесовых мышах роль средней кнопки почти всегда выполняет это самое колёсико. А на ноутбучных тачпадах тот же эффект достигается одновременным нажатием обеих кнопок. Правда, что делать на входящих в моду ноутбуках с однокнопочными тачпадами — не знаю; разве что, не покупать их...</p>
    <p class="Textbody">Из поставленных задач по улучшательству консоли проще всего решается первоочередная — включение службы консольной мыши, сиречь gpm. Для этого нужно, как это ни парадоксально, установить пакет gpm:</p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">$ sudo apt install gpm</span> </p>
    <p class="Textbody">Если сделать это, находясь в чистой консоли (а перключиться в любую из них можно по комбинации клавиш Control+Alt+F#, # — от 1 до 6; возврат в графический сеанс — Alt+F8), то немедленно после завершения установки можно будет увидеть курсор мыши в виде прямоугольничка. И теперь, по крайней мере, не придётся при всяких ремонтно-восстановительных работах вводить много лишних символов — в распоряжении применителя описанный выше «мышиный» буфер.</p>
    <p class="Textbody">Следующая задача на очереди — установка удобочитаемого экранного шрифта. Проще всего она решается утилитой dpkg-reconfigure. Вызванная в таком виде</p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">$ sudo dpkg-reconfigure console-setup</span> </p>
    <p class="Textbody">она запустит псевдографическую программу, настройки экранных шрифтов для консоли. Которая сначала попросит выбрать кодировку:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2014/12/param_078.png">
        <img alt="Изображение229" class="frameGraphics" id="229graphic" src="http://alv.me/wp-content/img/im_cin_img/param_078-572x363.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:364.82898px" />
      </a>
      <a id="a229graphic"></a>
      <a id="bkm229graphic"></a>
    </p>
    <p class="Textbody">Затем спросит об используемой таблице символов:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2014/12/param_079.png">
        <img alt="Изображение230" class="frameGraphics" id="230graphic" src="http://alv.me/wp-content/img/im_cin_img/param_079-572x382.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:383.84px" />
      </a>
      <a id="a230graphic"></a>
      <a id="bkm230graphic"></a>
    </p>
    <p class="Textbody">Потом последует предложение выбрать шрифт:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2014/12/param_080.png">
        <img alt="Изображение231" class="frameGraphics" id="231graphic" src="http://alv.me/wp-content/img/im_cin_img/param_080-572x382.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:383.84px" />
      </a>
      <a id="a231graphic"></a>
      <a id="bkm231graphic"></a>
    </p>
    <p class="Textbody">Далее будет проведён маленький ликбез о консольных шрифтах и условиях их использования:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2014/12/param_081.png">
        <img alt="Изображение232" class="frameGraphics" id="232graphic" src="http://alv.me/wp-content/img/im_cin_img/param_081-572x382.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:383.84px" />
      </a>
      <a id="a232graphic"></a>
      <a id="bkm232graphic"></a>
    </p>
    <p class="Textbody">Не советую им пренебрегать — после этого легче сделать осознанный выбор матрицы шрифта (типографские термины к консольным шрифтам не применимы):</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2014/12/param_082.png">
        <img alt="Изображение233" class="frameGraphics" id="233graphic" src="http://alv.me/wp-content/img/im_cin_img/param_082-572x382.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:383.84px" />
      </a>
      <a id="a233graphic"></a>
      <a id="bkm233graphic"></a>
    </p>
    <p class="Textbody">После этого происходит выход из интерфейса утилиты, и всё заказанное претворяется в действительность. Процесс этот связан с регенерацией initrd, так что его результат можно будет увидеть только после рестарта — с которым, впрочем, не обязательно торопиться.</p>
    <p class="Textbody">Третья задача очень важна для меня — но возможно, что большинству применителей решать её не придётся. Я использую сочетание варианта Typewriter Legacy для кириллической раскладки и CapsLock в качестве переключателя латиница/кириллица. Когда-то эта была стандартная комбинация (именно такова была первая русская раскладка для UNIX-косоли, созданная Андреем Черновым aka ache), но ныне воспринимается как экзотика. И её «спаривание» для консоли Linux требует некоторых усилий. В частности, в большинстве дистрибутивов мне приходилось прибегать к раскладке, изготовленной собственноручно.</p>
    <p class="Textbody">А вот в Mint эти усилия минимальны. Я имел не один раз повод радостно сообщить, что выбранная при установке раскладка клавиатуры и один из её вариантов (среди которых имеется и Typewriter Legacy) наследуется не только Иксами, но и консолью установленной системы. Правда, с переключением раскладок по Alt+Shift, порождённым каким-то умником в недрах Microsoft'а вместе с раскладкой winkeys (также одной из самых неудобных, какую только можно придумать).</p>
    <p class="Textbody">Однако задача с изменением переключателя решается очень просто: достаточно отредактировать файл /etc/default/keyboard. Он практически точно совпадает с клавиатурной секцией старого /etc/X11/xorg.conf или современного /etc/X11/xorg.conf.d/10-keymap.conf, и по умолчанию выглядит так:</p>
    <p class="Textbody"><span style="background-color:#dddddd">XKBMODEL="pc105"</span> </p>
    <p class="Textbody"><span style="background-color:#dddddd">XKBLAYOUT="us,ru"</span> </p>
    <p class="Textbody"><span style="background-color:#dddddd">XKBVARIANT=",typewriter-legacy"</span> </p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">XKBOPTIONS="grp:alt_shift_toggle,grp_led:scroll"</span> </p>
    <p class="Textbody">Так что в нём достаточно заменить значение переключателя alt_shift_toggle на желаемое, например, для меня — на caps_toggle. После чего можно с чистым сердцем перегружаться и, авторизовавшись в любой текстовой консоли, любоваться красивыми шрифтами семейства Terminus, созданными Димитром Жековым, набирать русские буквы в привычной раскладке и, при необходимости, копировать набранное из консоли в консоль через «мышиный» буфер.</p>
    <h3 id="toc60"><a id="RefHeading15621713816058"></a><a id="bkmRefHeading15621713816058"></a><a id="toc59"></a><a id="bkmtoc59"></a><a id="RefHeading4141136957987"></a><a id="bkmRefHeading4141136957987"></a><a id="bkmRefHeading4141136957987"></a><a id="bkmbkmRefHeading4141136957987"></a>GRUB2: восстановление загрузчика</h3>
    <p class="Textbody">В заключение всей «конфигурационной солянки» — пара слов о загрузчике GRUB2. Материалов в Сети на эту тему немерянно (одним из самых полезных мне представляется <a href="http://ru.wikibooks.org/wiki/Grub_2#.D0.92.D0.BE.D1.81.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_GRUB2_.D1.81_LiveCD._.D1.81.D0.BF.D0.BE.D1.81.D0.BE.D0.B1_3_.28.D1.81.D0.BE.D0.B2.D1.81.D0.B5.D0.BC_.D0.BF.D1.80.D0.BE.D1.81.D1.82.D0.BE.D0.B9.29" target="_blank">вот этот</a>), и пересказывать их я не намерен. А остановлюсь только на восстановлении загрузчика в случае его порчи по каким-либо причинам.</p>
    <p class="Textbody">Есть несколько методов восстановления GRUB2, я опишу тот, который представляется мне самым простым.</p>
    <p class="Textbody">Для начала надо иметь Live-носитель Mint в любом виде — DVD-, флешки, SD-карты, каковой помещается куда следует. При рестарте машины, обычно в момент появления логотипа производителя, нужно успеть нажать клавишу быстрого выбора загрузочного устройства — для современных ASUS'овских «матерей» это F8, для ASRock'овских — F11, для прочих — см. документацию. И в появившемся меню выбрать нужный пункт, он обычно называется явным образом. Происходит загрузка Live-среды, каковая в нашем случае представлена Mint с Cinnamon-окружением.</p>
    <p class="Textbody">Далее следует опознать имя файла устройства, несущего корневой раздел системы, загрузчик которой подлежит восстановлению — подчёркиваю, требуется имя устройства, а не раздела. Это можно сделать просмотром вывода либо команды</p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">$ sudo fdisk -l</span> </p>
    <p class="Textbody">либо команды</p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">$ ls /dev/sd*</span> </p>
    <p class="Textbody">Предположим для определённости, что это устройство /dev/sda. Теперь корневой раздел монтируется в файловую систему Live-среды. Прще всего сделать это через Nemo — в его боковой панели, в секции Носители, отражаются все присутствующие в машине дисковые устройства. И достаточно выбрать пункт Присоединить контекстного меню или просто «левокликнуть» на соответствующем имени. Теперь главное — определить точку монтирования. В Mint (как и во всех Ubuntu'идах) временно смотированные устройства попадают в каталог /media/username, устройства с меткой — в подкаталог с её именем, без оной — в подкаталог с универсальным идентификатором устройства (UID), это полуметровая зубодробительная последовательность букв и цифр.</p>
    <p class="Textbody">А вот теперь — собственно восстановление загрузчика. Оно выполняется одной командой:</p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">$ sudo grub-install --root-directory=/media/username/mount_point /dev/sda</span> </p>
    <p class="Textbody">Здесь mount_point — метка диска или его очень простой UID вроде d55aebcb-7e7d-4d34-aff4-ed6e494e9b7f. Автодополнение в этом случае не работает, однако, даже если устройство не «помечено», его UID можно взять из файла /etc/mtab, описывающего временно смонтированные устройства, или, открыв его в Nemo, из адресной строки последнего.</p>
    <p class="Textbody">На этом дело восстановления загрузчика закончено — можно перезагружаться в нормальном режиме.</p>
