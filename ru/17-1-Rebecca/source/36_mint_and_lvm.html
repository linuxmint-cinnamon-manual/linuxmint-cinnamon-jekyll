    <h2 id="toc213"><a id="RefHeading18681713816058"></a><a id="bkmRefHeading18681713816058"></a><a id="toc212"></a><a id="bkmtoc212"></a><a id="RefHeading13081136957987"></a><a id="bkmRefHeading13081136957987"></a><a id="bkmRefHeading13081136957987"></a><a id="bkmbkmRefHeading13081136957987"></a>Mint и LVM</h2>
    <p class="Textbody">Тема этого очерка образовалась в значительной мере как результат случайности. Которая началась с того, что я стал счастливым обладателем SSD-накопителя производства Crucial MX100 объёмом 512 ГБ, и в результате дисковая подсистема, упакованная внутри моего десктопа, стала выглядеть так:</p>
    <ul style="margin-top:0;margin-bottom:0;list-style-type:disc;clear:left">
      <li>
        <p class="Textbody">вышеупомянутый полутерабайтный Crucial — на первом SATA-разъёме; </p>
      </li>
      <li>
        <p class="Textbody">SanDisk Extreme SSD, 120 Гбайт — на втором; </p>
      </li>
      <li>
        <p class="Textbody">он же, то есть точно такой же — на третьем; </p>
      </li>
      <li>
        <p class="Textbody">традиционный винчестер Seagate ST3500410AS о 500-х гигабайтах — на четвёртом. </p>
      </li>
    </ul>
    <p class="Textbody">Первый SSD в ходе установки Mint 17.1 Rebecca был разбит на три раздела:</p>
    <ul style="margin-top:0;margin-bottom:0;list-style-type:disc;clear:left">
      <li>
        <p class="Textbody">/dev/sda1 объёмом 20 ГБ с файловой системой ext4 под корень файловой иерархии; </p>
      </li>
      <li>
        <p class="Textbody">/dev/sda2 объёмом 10 ГБ, также с ext4 — под каталог будущего пользователя, то есть меня — /home/alv (в домашнем каталоге я храню только dot-файлы и некоторые служебные данные, на что указанного объёма хватало с лихвой); </p>
      </li>
      <li>
        <p class="Textbody">/dev/sda3 на всё оставшееся пространство — без файловой системы и, сооветственно, без точки монтирования. </p>
      </li>
    </ul>
    <p class="Textbody">На обоих SanDisk'ах было создано по разделу, занимающему их целиком (/dev/sdb1 и /dev/sdc1, соответственно), также без файловой системы. Вместе с /dev/sda3 они предназначались для объединения в хренилище моих рабочих данных — организация оного и является предметом данных очерков.</p>
    <p class="Textbody">Винчестер у меня служит для экспериментальных целей, и потому разметка его постоянно меняется, да и к нашей теме не относится. За исключением того, что первые 32 ГБ диска выделены в раздел/dev/sdd1, служащий swap'ом для всех моих систем.</p>
    <p class="Textbody">Очевидно, что организация хранилища из трёх устройств требовала их объединения тем или иным способом. И поначалу напрашивался выбор ZFS: эту систему хранения данных я люблю, более-менее знаю, и включал её поддержку в сборки своих вариантов Mint 17. Однако тут модули ZFS у меня неожиданно с первого раза не собрались. Правда, проблема решилась (благодаря помощи Станислава Шрамко aka stanis, о чём пойдёт речь в следующем очерке), однако, как говорится, осадок остался. Ибо случай этот послужил напоминанием не только о бренности бытия, но и птичьих правах, на которых существует ZFS on Linux.</p>
    <p class="Textbody">В своё время, более десяти лет назад, я очень увлекался технологией LVM, тогда ещё 1-й версии. Потом я это дело забросил по двум причинам. Во-первых, во времена винчестеров с PATA-интерфейсом было очень сложно сконфигурировать многодисковую систему LVM без деградации производительности. Во-вторых, инструментарий CLI для создания такой системы и последующего управления ею показался мне при использовании в «домашних» условиях неоправданно сложным — особенно в сравнении с появившейся вскоре ZFS.</p>
    <p class="Textbody">Ныне, в эпозу безраздельного господства SATA-накопителей, первое препятствие к применению LVM отпало полностью. Что касается второго, то оно во многом сглаживается наличием графических оболочек, изолирующих применителя от низкоуровневых команд. Одну из которых system-config-lvm, я и использовал нынче.</p>
    <p class="Textbody">С тех пор, как я имел дело с LVM, появилась LVM2, предоставляющая ряд дополнительных возможностей, таких, как расширение логического тома на вновь подключённые физические тома. Однако суть технологии, терминология, утилиты CLI для работы с LVM почти не изменились. Да и в сети можно найти много не менее подробных, но более свежих материалов по теме. Так что на этих вопросах останавливаться не буду, ограничившись маленьким терминологическим конспектом.</p>
    <p class="Textbody">Сама по себе система LVM — уровень абстракции между физическими носителями (дисками, их разделами и массивами) и обычными файловыми системами. Она позволяет объединять в логические тома разделы с разных дисков, изменять их размер в сторону увеличения (за счёт присоединения новых накопителей) и, с некоторыми оговорками, уменьшения. В основе её лежит понятие физического тома (PV — Physical volume). Это — обычный дисковый раздел, для которого устанавливается идентификатор типа (ID) 8e. Вопреки написанному в некоторых сетевых материалах, целый диск как raw-устройство типа /dev/sd? в качестве физического тома выступать не может. Другое дело, что созданный на нём раздел с ID 8e может занимать и весь диск и даже RAID, программный или аппаратный.</p>
    <p class="Textbody">Физический том делится на «куски», именуемые физическими экстентами (Physical Extent, PE — по традиции оставлю этот термин без перевода, так как предлагаемый русскоязычной Википедией диапазон может ввести в заблуждение). Это — нечто вроде аналогов физических блоков (секторов) обычного винчестера, их размер по умолчанию 4 МБ, но может быть изменён в обе стороны.</p>
    <p class="Textbody">Физические тома объединяются в группу томов (VG — Volume group), которая выступает как единое целое и может рассматриваться как логическиий аналог raw-накопителя. И, подобно последнему, делится на разделы — поскольку над физикой мы уже поднялись, они назваются логическими томами (LV — Logical volume). А уж те — опять-таки на «куски», которые, как нетрудно догадаться, носят имя логических экстентов (LE — Logical extent). По размеру логический экстент равен экстенту физическому, которому он ставится в соответствие — однозначно, но одним из двух методов:</p>
    <ol style="margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left">
      <li>
        <p class="Textbody">линейным (linear mapping), когда логические экстенты последовательно привязываются к физическим сначала первого физического тома, потом второго, и так далее, подобно линейному режиму RAID; </p>
      </li>
      <li>
        <p class="Textbody">«черезполосным» (striped mapping), при котором «куски» логических экстентов (так называемые блоки чередования, по умолчанию равные 4 КБ) распределяются по физическим экстентам чередующихся физических томов. </p>
      </li>
    </ol>
    <p class="Textbody">Последний метод, сходен с расщеплением данных в RAID Level 0 и, подобно последнему, теоретически способствует быстродействию дисковых операций. При этом очевидно (и важно в контексте дальнейшего развития сюжета), что размер логического тома с чередованием не может быть больше наименьшего из входящих в него томов физических.</p>
    <p class="Textbody">В ходе создания собственного хренилища LVM, оказалось, что существует ещё и метод зеркалирования. Надо полагать, что это некое подобие RAID Level 1. Но, поскольку для меня это не актуально, выяснением деталей не занимался.</p>
    <p class="Textbody">Вне зависимости от метода соответствия логических и физических экстентов, логические тома предназначены для того, чтобы нести на себе файловые системы, подобно обычным дисковым разделам, причём точно те же самые — любые нативные для Linux'а: ext2/ext3/ext4, XFS, ReiserFS, JFS.</p>
    <p class="Textbody">На этом терминологическое введение можно считать законченным — перехожу к описанию действий по организации хранилища данных.</p>
    <p class="Textbody">Пакет LVM2, предоставляющий утилиты CLI для работы с логическими томами, устанавливается в Mint по умолчанию. Однако, как говорилось выше, LVM — не тюрьма народов, и не заставляет применителя её зубрить полсотни команд этого пакета (я почти не преувеличиваю — их там 48). Потому что в репозиториях доступна графическая оболочка, интегрирующая все их функции — system-config-lvm. В скобках замечу, что это не просто самая распространённая «морда» к утилитам lvm2, но и единственная активно развиваемая в настоящее время. Так что перво-наперво её следует установить, что я и проделал:</p>
    <p class="Textbody" style="margin-top:0;margin-bottom:17.990553px"><span style="background-color:#dddddd">$ apt install system-config-lvm</span> </p>
    <p class="Textbody">После установки программа под именем Управление логическими томами обнаружилась в секции Администрирование главного меню Cinnamon, откуда и была запущена после ввода пароля, демонстрируя в моём случае такую картину:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_214.png">
        <img alt="Изображение563" class="frameGraphics" id="563graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_214-572x325.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:326.84476px" />
      </a>
      <a id="a565graphic"></a>
      <a id="bkm565graphic"></a>
    </p>
    <p class="Textbody">Правда, здесь надо учесть, что перед её запуском я через fdisk установил ID разделов, предназначенных на растерзание LVM, равным 8e. Что в принципе не обязательно — это можно сделать и в графической оболочке, нажав кнопку Инициализировать раздел:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_215.png">
        <img alt="Изображение564" class="frameGraphics" id="564graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_215-572x325.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:326.84476px" />
      </a>
      <a id="a566graphic"></a>
      <a id="bkm566graphic"></a>
    </p>
    <p class="Textbody">Однако сам раздел должен быть создан заблаговременно — зафиксировав курсор на неразмеченном пространстве, можно видеть, что кнопка инциализации просто не активна:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_216.png">
        <img alt="Изображение565" class="frameGraphics" id="565graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_216-572x325.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:326.84476px" />
      </a>
      <a id="a567graphic"></a>
      <a id="bkm567graphic"></a>
    </p>
    <p class="Textbody">Вне зависимости от того, каким способом были инциализированы разделы, первым шагом после этого будет создание группы томов посредством фиксации одного из инициализированных разделов (я сделал это для самого «жирного») и нажатия кнопки Создать новую:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_217.png">
        <img alt="Изображение566" class="frameGraphics" id="566graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_217-572x325.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:326.84476px" />
      </a>
      <a id="a568graphic"></a>
      <a id="bkm568graphic"></a>
    </p>
    <p class="Textbody">В вызываемой её панели достаточно задать какое-либо имя для группы томов, желательно осмысленное, например:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_218.png">
        <img alt="Изображение567" class="frameGraphics" id="567graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_218.png" style="border:1.0px solid #000080;padding:0;width:436.829px;height:237.83685px" />
      </a>
      <a id="a569graphic"></a>
      <a id="bkm569graphic"></a>
    </p>
    <p class="Textbody">Впрочем, можно и изменить размер физического экстента в диапазоне от 2 до 1024 МБ — если, конечно, точно знаете, что это нужно (я — так не уверен, поэтому все остальные параметры оставил умолчальными):</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_219.png">
        <img alt="Изображение568" class="frameGraphics" id="568graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_219.png" style="border:1.0px solid #000080;padding:0;width:478.85733px;height:364.82898px" />
      </a>
      <a id="a570graphic"></a>
      <a id="bkm570graphic"></a>
    </p>
    <p class="Textbody">После этого я полюбовался на физический и логический вид группы томов (состоящей пока из одного физического тома, раздела /dev/sda3):</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_220.png">
        <img alt="Изображение569" class="frameGraphics" id="569graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_220-572x336.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:337.84314px" />
      </a>
      <a id="a571graphic"></a>
      <a id="bkm571graphic"></a>
    </p>
    <p class="Textbody">После чего занялся добавлением в группу физических томов — то есть в моём случае разделов /dev/sdb1 и /dev/sdc1. Для чего просто указывается группа, в которую надо добавить соотвтетсвующее устройство — поскольку группа у меня одна, то и ломать тут голову не над чем:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_221.png">
        <img alt="Изображение570" class="frameGraphics" id="570graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_221.png" style="border:1.0px solid #000080;padding:0;width:412.82895px;height:225.85576px" />
      </a>
      <a id="a572graphic"></a>
      <a id="bkm572graphic"></a>
    </p>
    <p class="Textbody">По завершении компоновки группы томов она стала выглядеть таким образом:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_222.png">
        <img alt="Изображение571" class="frameGraphics" id="571graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_222-572x336.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:337.84314px" />
      </a>
      <a id="a573graphic"></a>
      <a id="bkm573graphic"></a>
    </p>
    <p class="Textbody">Теперь настал черёд поделить эту группу на логические тома. Оно сводится к</p>
    <ul style="margin-top:0;margin-bottom:0;list-style-type:disc;clear:left">
      <li>
        <p class="Textbody">определению имени тома (опять таки желательно осмысленного — на следующем скриншоте рассмотрен пример тома для текущих проектов); </p>
      </li>
      <li>
        <p class="Textbody">заданию метода соответствия логических экстентов физическим — в примере «чересполосного»; </p>
      </li>
      <li>
        <p class="Textbody">числа «полос» — поскольку в группе томов участвует три устройства, значение его очевидно; </p>
      </li>
      <li>
        <p class="Textbody">размера блока чередования — я сохранил умолчальные 4 килобайта, но его можно увеличить до 512 КБ (опять же не знаю, нужно ли это): </p>
      </li>
    </ul>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_223.png">
        <img alt="Изображение572" class="frameGraphics" id="572graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_223-502x572.png" style="border:1.0px solid #000080;padding:0;width:503.84003px;height:573.83685px" />
      </a>
      <a id="a574graphic"></a>
      <a id="bkm574graphic"></a>
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_223.png"> </a>
    </p>
    <p class="Textbody">Затем я задал размер тома и файловую систему для него — в моей системе доступны ext всех видов и XFS:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_224.png">
        <img alt="Изображение573" class="frameGraphics" id="573graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_224-504x572.png" style="border:1.0px solid #000080;padding:0;width:505.84314px;height:573.83685px" />
      </a>
      <a id="a575graphic"></a>
      <a id="bkm575graphic"></a>
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_224.png"> </a>
    </p>
    <p class="Textbody">После чего осталось указать условия монтирования тома точку для оного:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_225.png">
        <img alt="Изображение574" class="frameGraphics" id="574graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_225.png" style="border:1.0px solid #000080;padding:0;width:504.8227px;height:547.8337px" />
      </a>
      <a id="a576graphic"></a>
      <a id="bkm576graphic"></a>
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_225.png"> </a>
    </p>
    <p class="Textbody">Нажав OK, я получил сообщение, что и такой точки не существует и предложение её создать, от которого, разумеется, невозможно отказаться:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_226.png">
        <img alt="Изображение575" class="frameGraphics" id="575graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_226.png" style="border:1.0px solid #000080;padding:0;width:444.84158px;height:134.84473px" />
      </a>
      <a id="a577graphic"></a>
      <a id="bkm577graphic"></a>
    </p>
    <p class="Textbody">Тем же манеров был создан том для размещёния виртуальных машин — как мне объяснили резонные люди, для них быстродействие дисковых операций также важно. На этом лимит томов с чередованием у меня был исчерпан, и оставшееся пространство я разделил на два «линейных» тома — под старые, но периодически нужные проекты, и под всякую всячину типа мультимедии:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_227.png">
        <img alt="Изображение576" class="frameGraphics" id="576graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_227.png" style="border:1.0px solid #000080;padding:0;width:504.8227px;height:547.8337px" />
      </a>
      <a id="a578graphic"></a>
      <a id="bkm578graphic"></a>
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_227.png"> </a>
    </p>
    <p class="Textbody">После чего физическая и логическая картины моей группы томов стали выглядеть так:</p>
    <p class="Textbody">
      <a href="http://alv.me/wp-content/img/2015/01/09-disks_228.png">
        <img alt="Изображение577" class="frameGraphics" id="577graphic" src="http://alv.me/wp-content/img/im_cin_img/09-disks_228-572x336.png" style="border:1.0px solid #000080;padding:0;width:573.83685px;height:337.84314px" />
      </a>
      <a id="a579graphic"></a>
      <a id="bkm579graphic"></a>
    </p>
    <p class="Textbody">Оставалось перезагрузиться (для страховки, можно было заказать и немедленное монтирование томов) и начать заполнять тома данными из бэкапов, разумеется, сделанных до начала не только развлечений с LVM, но и до установки Rebecca.</p>
